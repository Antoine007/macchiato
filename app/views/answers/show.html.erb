<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.4/d3.min.js"></script>

<br>
<br>
<h1 class = "text-center"><%= t('user_results_title') %></h1>
<!-- <p>score_x: <%#= @result[0] %></p>
<p>score_y: <%#= @result[1] %></p>
<p>score_z: <%#= @result[2] %></p>
<p>angle: <%= @angle %></p>-->
<!-- <p class = "text-center"> Your personnality type: </p> -->
<h3 class = "text-center"><%= t('category' + @result.category.to_s) %></h3>
<br>
<p class = "text-center"><%= t('category' + @result.category.to_s + '_text') %></p>


<!-- <div class= "circle_user" style="background:
    linear-gradient(36deg, #272b66 42.34%, yellow 42.34%) 0 0;">
</div> -->

<div class="container">

  <div class="row result-row" >
    <!-- <div class="col-md-2"></div> -->
    <div class="col-md-12 text-center">
      <div class = "row">
        <div class = "col-md-3 col-xs-3" style="color:blue" >
          <%= t('introverted') %>
        </div>
        <div class = "col-md-6 col-xs-6">
          <div class = "col-md-6 col-xs-6 background-bar-left" id="x-left">
            <div class="black-bar-left"></div>
          </div>
          <div class = "col-md-6 col-xs-6 background-bar-right" id="x-right">
            <div class="black-bar-right"></div>
          </div>
        </div>
        <div class = "col-md-3 col-xs-3" style="color:red">
          <%= t('extraverted') %>
        </div>
      </div>
    </div>
    <!-- <div class="col-md-2"></div> -->
  </div>

  <div class="row result-row">
    <!-- <div class="col-md-2"></div> -->
    <div class="col-md-12 text-center">
      <div class = "row">
        <div class = "col-md-3 col-xs-3" style="color:blue" >
          <%= t('intuitive') %>
        </div>
        <div class = "col-md-6 col-xs-6">
          <div class = "col-md-6 col-xs-6 background-bar-left" id="y-left">
            <div class="black-bar-left"></div>
          </div>
          <div class = "col-md-6 col-xs-6 background-bar-right" id="y-right">
            <div class="black-bar-right"></div>
          </div>
        </div>
        <div class = "col-md-3 col-xs-3" style="color:red">
          <%= t('thoughtful') %>
        </div>
      </div>
    </div>
    <!-- <div class="col-md-2"></div> -->
  </div>

  <div class="row result-row">
    <!-- <div class="col-md-2"></div> -->
    <div class="col-md-12 text-center">
      <div class = "row">
        <div class = "col-md-3 col-xs-3" style="color:blue" >
          <%= t('careful') %>
        </div>
        <div class = "col-md-6 col-xs-6">
          <div class = "col-md-6 col-xs-6 background-bar-left" id="z-left">
            <div class="black-bar-left"></div>
          </div>
          <div class = "col-md-6 col-xs-6 background-bar-right" id="z-right">
            <div class="black-bar-right"></div>
          </div>
        </div>
        <div class = "col-md-3 col-xs-3" style="color:red">
          <%= t('decisive') %>
        </div>
      </div>
    </div>
    <!-- <div class="col-md-2"></div> -->
  </div>
    <!-- <div class="row">
      <div class="col-md-4"></div>
      <div class="col-md-4">
        <p>score_x_max: <%#= @result[3] %></p>
        <p>score_y_max: <%#= @result[4] %></p>
        <p>score_z_max: <%#= @result[5] %></p>
      </div>
      <div class="col-md-4"></div>
    </div> -->




  <div class="row">
  <!-- <div class="col-md-4"></div> -->
    <div class="col-md-12">
      <div id="pieChart" class="text-center"></div>
    </div>
  <!-- <div class="col-md-4"></div> -->
  </div>

  <br>
  <br>

  <div class="row">
    <div class="col-md-3"></div>
    <div class="col-md-6">
      <%= link_to t('all_personnalities'), all_answers_path , :target => "_blank", :class => "btn btn-block btn-contact btn-cs"  %>
    </div>
    <div class="col-md-3"></div>
  </div>

  <br>

</div>

<%= javascript_tag do %>
var introverted = "<%= t('introverted') %>"
var extraverted = "<%= t('extraverted') %>"
var thoughtful  = "<%= t('thoughtful')  %>"
var intuitive   = "<%= t('intuitive')   %>"
var z = (<%= @result[0][2] %> < 0 ) ? 0 : 8;

var labels = ["<%= t('category1') %>",
              "<%= t('category2') %>",
              "<%= t('category3') %>",
              "<%= t('category4') %>",
              "<%= t('category5') %>",
              "<%= t('category6') %>",
              "<%= t('category7') %>",
              "<%= t('category8') %>",
              "<%= t('category9') %>",
              "<%= t('category10')%>",
              "<%= t('category11')%>",
              "<%= t('category12')%>",
              "<%= t('category13')%>",
              "<%= t('category14')%>",
              "<%= t('category15')%>",
              "<%= t('category16')%>"];


var pie = new d3pie("pieChart", {
  "header": {
    "title": {
      "text": "<%= t('category' + @result.category.to_s) %>",
      "color": "#ff0000",
      "fontSize": 34,
      "font": "cinzel"
    },
    "subtitle": {
      "color": "#999999",
      "fontSize": 10,
      "font": "courier"
    },
    "location": "pie-center",
    "titleSubtitlePadding": 10
  },
  "footer": {
    "color": "#999999",
    "fontSize": 10,
    "font": "open sans",
    "location": "bottom-left"
  },
  "size": {
    "canvasWidth": 590,
    "pieInnerRadius": "68%",
    "pieOuterRadius": "100%"
  },
  "data": {
    "content": [
      {
        "opacity": 0.1,
        "label": thoughtful,
        "value": 1,
        "color": "#ff0000"
      },
      {
        "opacity": 0.9,
        "label": labels[0+z],
        "value": 12,
        "color": "#FFCF00"
      },
      {
        "opacity": 0.1,
        "label": labels[1+z],
        "value": 12,
        "color": "#FF7D01"
      },
      {
        "opacity": 0.1,
        "label": extraverted,
        "value": 1,
        "color": "#000000"
      },
      {
        "opacity": 0.1,
        "label": labels[2+z],
        "value": 12,
        "color": "#F42494"
      },
      {
        "opacity": 0.1,
        "label": labels[3+z],
        "value": 12,
        "color": "#8B20BB"
      },
      {
        "opacity": 0.1,
        "label": intuitive,
        "value": 1,
        "color": "#ff0000"
      },
      {
        "opacity": 0.1,
        "label": labels[4+z],
        "value": 12,
        "color": "#007AC7"
      },
      {
        "opacity": 0.1,
        "label": labels[5+z],
        "value": 12,
        "color": "#00B2D6"
      },
      {
        "opacity": 0.1,
        "label": introverted,
        "value": 1,
        "color": "#000000"
      },
      {
        "opacity": 0.1,
        "label": labels[6+z],
        "value": 12,
        "color": "#02B801"
      },
      {
        "opacity": 0.1,
        "label": labels[7+z],
        "value": 12,
        "color": "#84CE00"
      }
    ]
  },
  "labels": {
    "outer": {
      "format": "none",
      "pieDistance": 10
    },
    "inner": {
      "format": "label"
    },
    "mainLabel": {
      "color": "#ffffff",
      "font": "cinzel",
      "fontSize": 17
    },
    "percentage": {
      "color": "#999999",
      "fontSize": 11,
      "decimalPlaces": 0
    },
    "value": {
      "color": "#cccc43",
      "fontSize": 11
    },
    "lines": {
      "enabled": true
    }
  },
  "effects": {
    "load": {
      "speed": 1290
    },
    "pullOutSegmentOnClick": {
      "effect": "elastic",
      "speed": 400,
      "size": 8
    }
  },
  "misc": {
    "colors": {
      "segmentStroke": "#9d8a6b"
    }
  }
});
<% end %>

<%= javascript_tag do %>
  $(document).ready(function(){
    setTimeout(function() {
      var background_bar_width = $('.background-bar-right').width()
      var new_width_x = <%= @result[0][0] / @result[1][0] %> * background_bar_width
      var new_width_y = <%= @result[0][1] / @result[1][1] %> * background_bar_width
      var new_width_z = <%= @result[0][2] / @result[1][2] %> * background_bar_width

      if (new_width_x > 0) {
        $('#x-right').html("<div class='ranking-bar stretchRight' id='x-result'></div>")
        $('#x-result').css({"width": new_width_x, "border-radius": "0 5px 5px 0"})
      } else {
        $('#x-left').html("<div class='ranking-bar stretchLeft' id='x-result'></div>")
         new_width_x = new_width_x * -1
        $('#x-result').css({"width": new_width_x, "border-radius": "5px 0 0 5px", "right": 0, "position" : "absolute"})
      }

      if (new_width_y > 0) {
        $('#y-right').html("<div class='ranking-bar stretchRight' id='y-result'></div>")
        $('#y-result').css({"width": new_width_y, "border-radius": "0 5px 5px 0"})
      } else {
        $('#y-left').html("<div class='ranking-bar stretchLeft' id='y-result'></div>")
         new_width_y = new_width_y * -1
        $('#y-result').css({"width": new_width_y, "border-radius": "5px 0 0 5px", "right": 0, "position" : "absolute"})
      }

      if (new_width_z > 0) {
        $('#z-right').html("<div class='ranking-bar stretchRight' id='z-result' ></div>")
        $('#z-result').css({"width": new_width_z, "border-radius": "0 5px 5px 0"})
      } else {
        $('#z-left').html("<div class='ranking-bar stretchLeft' id='z-result'></div>")
         new_width_z = new_width_z * -1
        $('#z-result').css({"width": new_width_z, "border-radius": "5px 0 0 5px", "right": 0, "position" : "absolute"})
      }
    }, 500);
  });

<% end %>



